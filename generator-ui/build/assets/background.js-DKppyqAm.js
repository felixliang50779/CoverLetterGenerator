chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"});chrome.runtime.onInstalled.addListener(n);chrome.commands.onCommand.addListener(async function(r){if(r==="get-selected-text"){const t=(await l())[0].result;chrome.storage.session.get(["templateTargets","currentlySelected"],s=>{if(s.templateTargets){const a=s.currentlySelected;s.templateTargets[a]=t,chrome.storage.session.set({templateTargets:s.templateTargets})}})}else(r==="toggle-previous-select"||r==="toggle-next-select")&&chrome.storage.session.get(["templateTargets","currentlySelected"],e=>{if(e.templateTargets){const t=Object.keys(e.templateTargets),s=t.indexOf(e.currentlySelected);let a;r==="toggle-previous-select"?a=s===0?t.at(-1):t.at(s-1):r==="toggle-next-select"&&(a=s===t.length-1?t.at(0):t.at(s+1)),chrome.storage.session.set({currentlySelected:a})}})});function n(r){chrome.tabs.query({},e=>{e.forEach(t=>{t.url.startsWith("chrome://")||chrome.tabs.reload(t.id)}),chrome.runtime.onInstalled.removeListener()})}function c(){var r="",e=document.activeElement,t=e?e.tagName.toLowerCase():null;return t=="textarea"||t=="input"&&/^(?:text|search|password|tel|url)$/i.test(e.type)&&typeof e.selectionStart=="number"?r=e.value.slice(e.selectionStart,e.selectionEnd):window.getSelection&&(r=window.getSelection().toString().trim()),window.console.log(r),r}async function o(){let r={active:!0,lastFocusedWindow:!0},[e]=await chrome.tabs.query(r);return e}async function l(){return new Promise(async(r,e)=>{const t=await o();chrome.scripting.executeScript({target:{tabId:t.id},func:c},s=>{r(s)})})}
