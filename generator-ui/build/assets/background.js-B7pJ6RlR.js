chrome.commands.onCommand.addListener(async function(a){if(a==="get-selected-text"){const t=(await g())[0].result;chrome.storage.session.get(["templateTargets","currentlySelected"],s=>{if(s.templateTargets){const n=s.currentlySelected;s.templateTargets[n]=t,chrome.storage.session.set({templateTargets:s.templateTargets},()=>{chrome.storage.session.get(["templateTargets"],r=>{Object.values(r.templateTargets).every(o=>o!=="")?c("Ready to Generate!",`Set value "${t}" for target ${n}`,"success-icon.png"):c("Success!",`Set value "${t}" for target ${n}`,"success-icon.png")})})}})}else(a==="toggle-previous-select"||a==="toggle-next-select")&&chrome.storage.session.get(["templateTargets","currentlySelected"],e=>{if(e.templateTargets){const t=Object.keys(e.templateTargets),s=t.indexOf(e.currentlySelected);let n;a==="toggle-previous-select"?n=s===0?t.at(-1):t.at(s-1):a==="toggle-next-select"&&(n=s===t.length-1?t.at(0):t.at(s+1)),chrome.storage.session.set({currentlySelected:n},()=>{c("Attention",`Now selecting for ${n}: ${e.templateTargets[n]}`,"alert-icon.png")})}})});async function c(a,e,t){const s=await chrome.notifications.create({type:"basic",iconUrl:t,title:a,message:e,silent:!0});setTimeout(()=>chrome.notifications.clear(s),1250)}function i(){var a="",e=document.activeElement,t=e?e.tagName.toLowerCase():null;return t=="textarea"||t=="input"&&/^(?:text|search|password|tel|url)$/i.test(e.type)&&typeof e.selectionStart=="number"?a=e.value.slice(e.selectionStart,e.selectionEnd):window.getSelection&&(a=window.getSelection().toString().trim()),window.console.log(a),a}async function l(){let a={active:!0,lastFocusedWindow:!0},[e]=await chrome.tabs.query(a);return e}async function g(){return new Promise(async(a,e)=>{const t=await l();chrome.scripting.executeScript({target:{tabId:t.id},func:i},s=>{a(s)})})}
